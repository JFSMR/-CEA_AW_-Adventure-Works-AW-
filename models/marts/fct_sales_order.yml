version: 2

models:
  - name: fct_sales_order
    description: >
      Fact table containing enriched sales order data for business consumption,
      combining order, product, credit card, sales reason, and financial metrics.
      Default values used to handle missing data.

    columns:
      - name: sales_order_fact_sk
        description: Surrogate key for the fact table, unique per sales order and reason.
        tests:
          - not_null
          - unique

      - name: sales_order_id
        description: Primary key of the sales order.
        tests:
          - not_null

      - name: customer_fk
        description: Foreign key to the customer dimension.
        tests:
          - not_null

      - name: address_fk
        description: Foreign key to the address dimension.
        tests:
          - not_null

      - name: creditcard_fk
        description: Foreign key to the credit card dimension. Defaults to 0 if missing.
        tests:
          - not_null
          - relationships:
              to: ref('int_creditcard')
              field: creditcard_pk
              where: "creditcard_fk != 0"

      - name: sales_reason_fk
        description: Foreign key to the sales reason dimension. Defaults to -1 if missing.
        tests:
          - not_null
          - relationships:
              to: ref('int_sales_reason')
              field: sales_reason_pk
              where: "sales_reason_fk != -1"

      - name: product_fk
        description: Foreign key to the product dimension.
        tests:
          - not_null

      - name: card_type
        description: Type of the credit card used. Defaults to 'Not Provided'.
        tests:
          - not_null

      - name: card_number
        description: Credit card number used in the transaction. Defaults to '0000-0000-0000-0000'.
        tests:
          - not_null

      - name: name_reason
        description: Name of the sales reason. Defaults to 'Not Provided'.
        tests:
          - not_null

      - name: type_reason
        description: Type of the sales reason. Defaults to 'Not Provided'.
        tests:
          - not_null

      - name: order_date
        description: Date when the order was placed.
        tests:
          - not_null

      - name: status
        description: >
          Textual status of the order. Mapped from original codes (e.g., 'Shipped' for 5).
          Can be null if no mapping applies.
        tests:
          - not_null

      - name: total_quantity
        description: Total quantity of items in the order (non-zero only for primary row).
        tests:
          - not_null

      - name: gross_total
        description: Gross total value of the order before discounts (non-zero only for primary row).
        tests:
          - not_null

      - name: net_total
        description: Net total value of the order after discounts (non-zero only for primary row).
        tests:
          - not_null
