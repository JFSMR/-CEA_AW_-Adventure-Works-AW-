version: 2

models:
  - name: int_fct_sales_order
    description: >
      Fact table containing enriched sales order data, including credit card,
      product, sales reason, and financial metrics. Null values are handled with
      default values to ensure consistency.

    columns:
      # Surrogate Key
      - name: sales_order_fact_sk
        description: Surrogate key for the fact table.
        tests:
          - not_null
          - unique

      # Foreign Keys
      - name: sales_order_id
        description: Primary key of the sales order.
        tests:
          - not_null

      - name: customer_fk
        description: Foreign key to the customer dimension.
        tests:
          - not_null

      - name: address_fk
        description: Foreign key to the address dimension.
        tests:
          - not_null

      - name: creditcard_fk
        description: Foreign key to the credit card dimension. Defaults to 0 if missing.
        tests:
          - not_null
          - accepted_values:
              values: [0]
              config:
                where: "creditcard_fk = 0"

      - name: sales_reason_fk
        description: Foreign key to the sales reason dimension. Defaults to -1 if missing.
        tests:
          - not_null
          - accepted_values:
              values: [-1]
              config:
                where: "sales_reason_fk = -1"

      - name: product_fk
        description: Foreign key to the product dimension.
        tests:
          - not_null

      # Dimensions
      - name: card_type
        description: Type of the credit card used.
        tests:
          - not_null

      - name: card_number
        description: Credit card number used in the transaction.
        tests:
          - not_null

      - name: name_reason
        description: Name of the sales reason. Defaults to 'Not Provided' if missing.
        tests:
          - not_null

      - name: type_reason
        description: Type of the sales reason. Defaults to 'Not Provided' if missing.
        tests:
          - not_null

      - name: order_date
        description: Date when the order was placed.
        tests:
          - not_null

      - name: status
        description: Status code of the order.
        tests:
          - not_null

      # Metrics
      - name: total_quantity
        description: Total quantity of items in the order.
        tests:
          - not_null

      - name: gross_total
        description: Gross total value of the order before discounts.
        tests:
          - not_null

      - name: net_total
        description: Net total value of the order after discounts.
        tests:
          - not_null
