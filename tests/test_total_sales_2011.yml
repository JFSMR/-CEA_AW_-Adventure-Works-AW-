version: 2

models:
  - name: test_total_sales_2011
    description: >
      Intermediate fact model containing aggregated sales order metrics, 
      enriched with relevant dimensional attributes for analytical use.

    tests:
      - dbt_expectations.expect_query_result_to_match:
          query: |
            with sales_2011 as (
              select 
                sum(gross_total) as gross_total
              from {{ this }}
              where extract(year from order_date) = 2011
            )
            select gross_total
            from sales_2011
            where gross_total not between 12646112.16 and 12646112.20
          name: gross_sales_2011_validation
          description: >
            Business validation test requested by CEO Carlos Silveira to ensure 
            the gross sales amount for the year 2011 matches the expected audited 
            value of $12,646,112.16. A small tolerance is applied to account for 
            floating-point precision in calculations. If this test fails, it may 
            indicate data quality issues in the input pipeline, logic flaws in 
            transformations, or discrepancies in the source system.
